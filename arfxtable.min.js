class Arfxtable{constructor(sourceProps={}){this.target=null,this.url=null,this.res=null,this.currentPage=1,this.searchTimer=null,this.totalElement=0,this.search=!0,this.pagination=!0,this.highlight=!0,this.highlightOptions={color:"black",background:"orange"},this.searchDelay=1e3,this.draw=0,this.start=0,this.pageLength=10,this.searchValue="",this.data=function(){return{}},this.dataset=[],this.columns=[],this.loaderAsset=this.loaderDefault(),this.trData=!1,this.recordsFiltered=0,this.dataLength=0;let props=Object.assign(this,sourceProps);Object.keys(props).map(v=>{this[v]=props[v]}),this.buildLoader(),this.buildTopContainer(),this.build()}generateData(){let data=this.data(),usp=new URLSearchParams(data);return usp.append("start",this.start),usp.append("length",this.pageLength),usp.append("search[value]",this.searchValue),usp}async build(){let _res=null;await fetch(this.url,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},redirect:"follow",referrerPolicy:"no-referrer",body:this.generateData()}).then(res=>res.json()).then(res=>{_res=res,this.dataLength=res.data.length,this.dataset=res.dataset}).catch(error=>{console.error("Error:",error)});let _data=_res.data;this.res=_res,this.recordsFiltered=_res.recordsFiltered;let tbody=document.querySelector(`${this.target} tbody`);tbody.innerHTML="";let columns={};this.columns.map(v=>{columns[v.target]=v}),_data.map((v,index)=>{let highest=1;v.map(vv=>{let isArray=Array.isArray(vv);highest=isArray&&vv.length>highest?vv.length:highest});for(let i=0;i<highest;i++){let tr=document.createElement("tr");!0===this.trData&&this.dataLength>0&&Object.keys(this.dataset[index]).map(vv=>{let isArray;Array.isArray(this.dataset[index][vv])?tr.setAttribute(`data-${vv}`,this.dataset[index][vv][i]):tr.setAttribute(`data-${vv}`,this.dataset[index][vv])}),v.map((vv,ii,aa)=>{let isArray;if(Array.isArray(vv)){let td=document.createElement("td");if(ii in columns&&"className"in columns[ii]){let classList=columns[ii].className.split(" ");td.classList.add(...classList)}td.innerHTML=void 0!==vv[i]?vv[i]:"",tr.appendChild(td)}else if(0==i){let td=document.createElement("td");if(ii in columns&&"className"in columns[ii]){let classList=columns[ii].className.split(" ");td.classList.add(...classList)}td.setAttribute("rowspan",highest),td.innerHTML=void 0!==vv?vv:"",tr.appendChild(td)}}),tbody.appendChild(tr)}}),0==_data.length&&(this.dataLength=0),this.pagination&&this.buildPagination(),this.highlight&&this.buildHighlight(),this.loader(!1)}reload(){this.loader(!0),this.start=0,this.build()}refresh(){this.loader(!0),this.build()}loader(active=!1){let loader;document.querySelector("#arfxtableLoader").style.display=active?"block":"none"}buildLoader(){let body=document.querySelector("body"),bg=document.createElement("div");bg.setAttribute("id","arfxtableLoader"),bg.setAttribute("style","\n            position: fixed;\n            top: 0;\n            display: block;\n            width: 100vw;\n            height: 100vh;\n            opacity: 0.5;\n            z-index: 10000; \n        "),body.appendChild(bg);let loaderDiv=this.loaderDiv();bg.appendChild(loaderDiv)}loaderDiv(){let div=document.createElement("div");return div.setAttribute("style","\n            margin-top: 40vh;\n        "),div.innerHTML=this.loaderAsset,div}loaderDefault(){return'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin:auto;display:block;" width="104px" height="104px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">\n        <circle cx="50" cy="50" fill="none" stroke="#777777" stroke-width="7" r="25" stroke-dasharray="117.80972450961724 41.269908169872416">\n          <animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform>\n        </circle>\n        </svg>'}buildPagination(){let arfxtable_pagination=document.querySelector("#arfxtable_pagination");null!=arfxtable_pagination&&arfxtable_pagination.remove();let totalPage=Math.ceil(this.res.recordsFiltered/this.pageLength),styleLi="\n            display: inline-block;\n            padding: 5px 10px;\n            border: 1px #dfe3e7 solid;\n            font-weight: bolder;\n        ",div=document.createElement("div");div.setAttribute("id","arfxtable_pagination"),div.setAttribute("style","\n            display: flex;\n            justify-content: space-between;\n        ");let divInfo=document.createElement("div");div.innerHTML=this.infoPagination();let ul=document.createElement("ul");div.appendChild(ul);let prevLi=document.createElement("li"),dividerLi;prevLi.setAttribute("data-page",parseInt(this.currentPage)-1),1==this.currentPage||0==this.dataLength?(prevLi.setAttribute("style",`\n            ${styleLi}\n            margin-right: 10px;\n            border-radius: 4px;\n            background: #dbdbdb;\n            `),prevLi.classList.add("arfxtable_pagination_disabled")):(prevLi.setAttribute("style",`\n            ${styleLi}\n            margin-right: 10px;\n            border-radius: 4px;\n            color: #5a8dee;\n            `),prevLi.setAttribute("onmouseover","\n            this.style.cursor = 'pointer';\n            this.style.background = '#dee8fc';\n            "),prevLi.setAttribute("onmouseleave","\n            this.style.background = 'none';\n            ")),prevLi.innerText="Sebelumnya",ul.appendChild(prevLi),document.createElement("li").innerText="...";let pageToShow=[];if(this.currentPage<5)for(let i=1;i<=totalPage;i++)i<=5&&pageToShow.push(i),6==i&&pageToShow.push("...",totalPage);else if(this.currentPage>totalPage-4){pageToShow.push(1,"...");for(let i=totalPage-4;totalPage>=i;i++)pageToShow.push(i)}else pageToShow.push(1,"...",parseInt(this.currentPage)-1,this.currentPage,parseInt(this.currentPage)+1,"...",totalPage);pageToShow.map((v,i,a)=>{let li=document.createElement("li");li.setAttribute("data-page",v),0==i?li.setAttribute("style",`\n                ${styleLi}\n                border-right: 0px;\n                border-top-left-radius: 4px;\n                border-bottom-left-radius: 4px;\n                `):i==a.length-1?li.setAttribute("style",`\n                ${styleLi}\n                border-left: 0px;\n                border-top-right-radius: 4px;\n                border-bottom-right-radius: 4px;\n                `):li.setAttribute("style",`\n                ${styleLi}\n                border-left: 0px;\n                border-right: 0px;\n                `),v==this.currentPage&&(li.style.background="#5a8dee",li.style.color="#ffffff",li.classList.add("arfxtable_pagination_disabled")),"..."==v&&li.classList.add("arfxtable_pagination_disabled"),v!=this.currentPage&&"..."!=v&&(li.setAttribute("onmouseover","\n                this.style.cursor = 'pointer';\n                this.style.background = '#dee8fc';\n                "),li.setAttribute("onmouseleave","\n                this.style.background = '#ffffff';\n                ")),li.innerText=v,ul.appendChild(li)});let nextLi=document.createElement("li"),table;nextLi.setAttribute("data-page",parseInt(this.currentPage)+1),this.currentPage==totalPage||0==this.dataLength?(nextLi.setAttribute("style",`\n            ${styleLi}\n            margin-left: 10px;\n            border-radius: 4px;\n            background: #dbdbdb;\n            `),nextLi.classList.add("arfxtable_pagination_disabled")):(nextLi.setAttribute("style",`\n            ${styleLi}\n            margin-left: 10px;\n            border-radius: 4px;\n            color: #5a8dee;\n            `),nextLi.setAttribute("onmouseover","\n            this.style.cursor = 'pointer';\n            this.style.background = '#dee8fc';\n            "),nextLi.setAttribute("onmouseleave","\n            this.style.background = 'none';\n            ")),nextLi.innerText="Selanjutnya",ul.appendChild(nextLi),document.querySelector(this.target).after(div),this.actionPagination()}actionPagination(){let pagination=document.querySelector("#arfxtable_pagination"),paginationButton=document.querySelectorAll("#arfxtable_pagination ul li:not(.arfxtable_pagination_disabled)"),self=this;paginationButton.forEach((function(v,i){v.addEventListener("click",(function(e){self.loader(!0);let page=e.currentTarget.dataset.page;self.currentPage=page,self.start=(self.currentPage-1)*self.pageLength,self.build()}))}))}infoPagination(){let start,end;return` Menampilkan ${0==this.recordsFiltered?0:parseInt(this.start)+1} sampai ${this.recordsFiltered>parseInt(this.start)+parseInt(this.pageLength)?parseInt(this.start)+parseInt(this.pageLength):this.recordsFiltered} dari ${this.recordsFiltered} data `}buildTopContainer(){let table=document.querySelector(`${this.target}`),div=document.createElement("div");div.setAttribute("id","arfxtable_top_container"),div.setAttribute("style","\n            padding: 10px 0px;\n            display: flex;\n            justify-content: space-between;\n            flex-direction: row-reverse;\n        "),table.before(div),this.search&&this.buildSearch()}buildSearch(){let topContainer=document.querySelector("#arfxtable_top_container"),div=document.createElement("div");div.setAttribute("id","arfxtable_search");let input=document.createElement("input");input.setAttribute("name","arfxtable_search"),input.setAttribute("placeholder","Cari..."),input.setAttribute("style","\n            height: 2rem;\n            padding: 0px 0.6rem;\n            border-radius: 0.3rem;\n            border: 1px solid #dfe3e7;\n            color: #676767;\n        "),input.setAttribute("onfocus","\n            this.style.outline = '0px';\n        "),div.appendChild(input),topContainer.appendChild(div),this.actionSearch()}actionSearch(){let search=document.querySelector('input[name="arfxtable_search"]'),self=this;search.addEventListener("keyup",(function(e){let selfSearch=this;self.delay((function(e){self.loader(!0),this.searchValue=selfSearch.value,this.start=0,this.build()}),self.searchDelay)}))}buildHighlight(){let self=this,tr;""!=self.searchValue&&document.querySelectorAll(`${this.target} tbody tr td`).forEach((function(el,i){let searchValue=new RegExp(`(${self.searchValue})(?!([^<]+)?>)`,"ig");el.innerHTML=el.innerHTML.replaceAll(searchValue,`<span style="padding: 0.2em; background: ${self.highlightOptions.background}; color: ${self.highlightOptions.color};">$1</span>`)}))}destroy(){console.log("table destroyed")}delay(fn,ms){clearTimeout(this.searchTimer),this.searchTimer=setTimeout(fn.bind(this),ms||0)}addElement(element,position){let div=document.createElement("div"),container;div.setAttribute("id",`arfxtable_element_${this.totalElement}`),div.classList.add(`arfxtable_${position}`),div.innerHTML=element(),document.querySelector(`#arfxtable_${position}_container`).append(div)}get start(){return this._start}set start(value){this._start=value}}function arfxtable(param={}){return new Arfxtable(param)}